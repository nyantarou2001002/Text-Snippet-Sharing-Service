<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snippet Share</title>
    <style>
        #editor {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }
    </style>
    <!-- Require.jsとMonaco Editorのスクリプトを読み込み -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>

    <!-- Monaco EditorのWeb Workerの設定 -->
    <script>
        window.MonacoEnvironment = {
            getWorkerUrl: function (workerId, label) {
                var workerUrl = 'data:text/javascript;charset=utf-8,';
                workerUrl += encodeURIComponent(`
                    self.MonacoEnvironment = {
                        baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/'
                    };
                    importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/base/worker/workerMain.js');
                `);
                return workerUrl;
            }
        };
    </script>

    <!-- Monaco Editorのメインスクリプトの読み込み -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.js"></script>
</head>
<body>
    <h1>Share your Snippet</h1>

    <!-- プログラム言語選択ドロップダウン -->
    <select id="language-selector">
        <option value="javascript">JavaScript</option>
        <option value="python">Python</option>
        <option value="php">PHP</option>
        <option value="html">HTML</option>
        <option value="css">CSS</option>
    </select>

    <!-- Monaco Editorが表示される部分 -->
    <div id="editor"></div>

    <!-- スニペットを送信するボタン -->
    <button id="submit-btn">Submit Snippet</button>

    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            var editor = monaco.editor.create(document.getElementById('editor'), {
                value: '// Write your code here...',
                language: 'javascript',
                theme: 'vs-dark'
            });

            // 言語選択が変更された際にエディターの言語を変更
            document.getElementById('language-selector').addEventListener('change', function() {
                var newLanguage = this.value;
                monaco.editor.setModelLanguage(editor.getModel(), newLanguage);
            });

            // 送信ボタンがクリックされたときの処理
            document.getElementById('submit-btn').addEventListener('click', function() {
                var snippetContent = editor.getValue();
                var selectedLanguage = document.getElementById('language-selector').value;

                fetch('/submit-snippet.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: snippetContent,
                        language: selectedLanguage
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.url) {
                        alert('Your snippet is available at: ' + data.url);
                    } else {
                        alert('There was an error saving your snippet.');
                    }
                });
            });
        });
    </script>
</body>
</html>
